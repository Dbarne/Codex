<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wedding Photo Upload</title>
    <link rel="stylesheet" href="/public/styles.css" />
  </head>
  <body class="guest-page">
    <main class="container">
      <section class="card hero">
        <p class="eyebrow">Wedding Memory Collection</p>
        <p class="wedding-title">Dan and Abi&apos;s Wedding</p>
        <p class="wedding-subtitle">Share your favourite moments with us</p>
        <h1>Share Your Wedding Photos and Videos</h1>
        <div class="hero-metrics">
          <p class="metric-chip">Photos: <strong><%= totalPhotoCount %> / <%= maxTotalPhotos %></strong></p>
          <p class="metric-chip">Videos: <strong><%= totalVideoCount %> / <%= maxTotalVideos %></strong></p>
        </div>
      </section>

      <section class="card upload-section" data-active-tab="<%= activeTab %>">
        <div class="section-head">
          <h2>Upload</h2>
          <p class="section-subtitle">Choose photos or videos and upload in a few taps.</p>
        </div>
        <ol class="upload-steps">
          <li><strong>Step 1:</strong> Enter your name</li>
          <li><strong>Step 2:</strong> Choose photos or videos</li>
          <li><strong>Step 3:</strong> Keep this page open until complete</li>
        </ol>

        <% if (message) { %>
          <p class="alert success"><%= message %></p>
        <% } %>

        <% if (error) { %>
          <p class="alert error"><%= error %></p>
        <% } %>

        <div class="upload-tabs" role="tablist" aria-label="Upload type">
          <button type="button" class="upload-tab-btn" data-tab-btn="photos" role="tab">
            <span class="tab-title">Photos</span>
            <span class="tab-subtitle">Fast and simple</span>
          </button>
          <button type="button" class="upload-tab-btn" data-tab-btn="videos" role="tab">
            <span class="tab-title">Videos</span>
            <span class="tab-subtitle">Best on Wi-Fi</span>
          </button>
        </div>

        <section class="upload-panel" data-upload-panel="photos" role="tabpanel">
          <form action="/upload" method="POST" enctype="multipart/form-data" class="upload-form" id="photo-upload-form">
            <label for="name-photos">Your name</label>
            <input id="name-photos" name="name" type="text" maxlength="120" required />
            <p id="photo-name-validation" class="field-validation" hidden>Please enter your name first.</p>

            <label for="photos">Your photos (up to <%= maxPhotoPerPerson %>)</label>
            <input
              id="photos"
              name="photos"
              type="file"
              accept="image/*"
              multiple
              required
              class="file-input-hidden"
            />
            <button type="button" id="choose-photos-btn" class="secondary">Choose Photos</button>
            <p id="photo-selection-status" class="small-note">No photos selected yet.</p>
            <p id="photo-files-validation" class="field-validation" hidden>Please choose at least one photo.</p>

            <button type="submit" id="upload-photos-submit-btn" disabled>Upload Photos</button>
            <button type="button" id="cancel-photo-upload-btn" class="secondary" hidden>Cancel Upload</button>
          </form>

          <div id="photo-upload-progress" class="upload-progress" hidden>
            <div id="photo-upload-progress-bar" class="upload-progress-bar"></div>
          </div>
          <p id="photo-upload-status" class="small-note" hidden>Preparing upload...</p>

          <p class="small-note">Only image files are accepted (max 20MB each).</p>
        </section>

        <section class="upload-panel" data-upload-panel="videos" role="tabpanel">
          <form action="/upload/videos" method="POST" enctype="multipart/form-data" class="upload-form" id="video-upload-form">
            <label for="name-videos">Your name</label>
            <input id="name-videos" name="name" type="text" maxlength="120" required />
            <p id="video-name-validation" class="field-validation" hidden>Please enter your name first.</p>

            <label for="videos">Your videos (up to <%= maxVideoPerPerson %>)</label>
            <input
              id="videos"
              name="videos"
              type="file"
              accept="video/*"
              multiple
              required
              class="file-input-hidden"
            />
            <button type="button" id="choose-videos-btn" class="secondary">Choose Videos</button>
            <p class="small-note">On iPhone/Android, the device&apos;s tick/done button is controlled by your phone and may pause while videos prepare.</p>
            <p id="video-selection-status" class="small-note">No videos selected yet.</p>
            <p id="video-files-validation" class="field-validation" hidden>Please choose at least one video.</p>
            <p id="video-size-warning" class="alert error" hidden></p>

            <button type="submit" id="upload-videos-submit-btn" disabled>Upload Videos</button>
            <button type="button" id="cancel-video-upload-btn" class="secondary" hidden>Cancel Upload</button>
          </form>

          <div id="video-upload-progress" class="upload-progress" hidden>
            <div id="video-upload-progress-bar" class="upload-progress-bar"></div>
          </div>
          <p id="video-upload-status" class="small-note" hidden>Preparing upload...</p>

          <p class="small-note">
            Video uploads are accepted up to <%= maxVideoSizeMb %>MB per file for better quality clips.
          </p>
        </section>
      </section>

      <section class="card qr-section">
        <h2>Guest QR Code</h2>
        <p>Print or share this QR code so guests can open this upload page quickly.</p>
        <img src="<%= qrCodeDataUrl %>" alt="QR code for wedding photo upload page" class="qr-image" />
        <p class="url"><%= baseUrl %></p>
      </section>

      <section class="card admin-link">
        <a href="/admin/login">Admin Login</a>
      </section>
    </main>

    <div id="upload-confirm-modal" class="confirm-modal" aria-hidden="true">
      <div class="confirm-modal-card">
        <h3>Large Upload Selected</h3>
        <p id="upload-confirm-text">This upload may take several minutes. Continue?</p>
        <div class="confirm-actions">
          <button type="button" id="upload-confirm-continue">Continue Upload</button>
          <button type="button" id="upload-confirm-cancel" class="secondary">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const uploadSection = document.querySelector('.upload-section');
        if (!uploadSection) {
          return;
        }

        const buttons = Array.from(document.querySelectorAll('[data-tab-btn]'));
        const panels = Array.from(document.querySelectorAll('[data-upload-panel]'));
        const initialTab = uploadSection.getAttribute('data-active-tab') === 'videos' ? 'videos' : 'photos';
        const confirmModal = document.getElementById('upload-confirm-modal');
        const confirmText = document.getElementById('upload-confirm-text');
        const confirmContinueBtn = document.getElementById('upload-confirm-continue');
        const confirmCancelBtn = document.getElementById('upload-confirm-cancel');
        let photoUploadBusy = false;
        let videoUploadBusy = false;
        let confirmResolver = null;

        function syncUploadBusyUi() {
          const isBusy = photoUploadBusy || videoUploadBusy;
          document.body.classList.toggle('upload-busy', isBusy);
          document.documentElement.classList.toggle('upload-busy', isBusy);
        }

        function formatBytes(bytes) {
          const gb = 1024 * 1024 * 1024;
          const mb = 1024 * 1024;
          if (bytes >= gb) {
            return `${(bytes / gb).toFixed(2)} GB`;
          }
          return `${(bytes / mb).toFixed(1)} MB`;
        }

        function closeConfirmModal(choice) {
          if (confirmResolver) {
            const resolver = confirmResolver;
            confirmResolver = null;
            resolver(choice);
          }

          if (confirmModal) {
            confirmModal.classList.remove('is-open');
            confirmModal.setAttribute('aria-hidden', 'true');
          }
        }

        function askConfirmation(message, continueLabel) {
          return new Promise(function (resolve) {
            if (!confirmModal || !confirmText || !confirmContinueBtn || !confirmCancelBtn) {
              resolve(true);
              return;
            }

            if (confirmResolver) {
              closeConfirmModal(false);
            }

            confirmResolver = resolve;
            confirmText.textContent = message;
            confirmContinueBtn.textContent = continueLabel || 'Continue';
            confirmModal.classList.add('is-open');
            confirmModal.setAttribute('aria-hidden', 'false');

            confirmContinueBtn.onclick = function () {
              closeConfirmModal(true);
            };
            confirmCancelBtn.onclick = function () {
              closeConfirmModal(false);
            };
          });
        }

        function setActiveTab(tabName) {
          buttons.forEach((button) => {
            const isActive = button.getAttribute('data-tab-btn') === tabName;
            button.classList.toggle('active', isActive);
            button.setAttribute('aria-selected', isActive ? 'true' : 'false');
          });

          panels.forEach((panel) => {
            const isActive = panel.getAttribute('data-upload-panel') === tabName;
            panel.classList.toggle('active', isActive);
            panel.hidden = !isActive;
          });
        }

        buttons.forEach((button) => {
          button.addEventListener('click', function () {
            setActiveTab(button.getAttribute('data-tab-btn'));
          });
        });

        function bindFilePicker(config) {
          const fileInput = document.getElementById(config.inputId);
          const chooseButton = document.getElementById(config.chooseButtonId);
          const submitButton = document.getElementById(config.submitButtonId);
          const status = document.getElementById(config.statusId);

          if (!fileInput || !chooseButton || !submitButton || !status) {
            return;
          }

          let waitingForPicker = false;
          function updateSelectionState() {
            const count = fileInput.files ? fileInput.files.length : 0;
            if (count === 0) {
              status.textContent = waitingForPicker && config.preparingLabel ? config.preparingLabel : config.emptyLabel;
              submitButton.disabled = true;
              return;
            }

            waitingForPicker = false;
            status.textContent = `${count} ${config.itemLabel}${count === 1 ? '' : 's'} selected.`;
            submitButton.disabled = false;
          }

          let pendingPickerCheck = false;
          function scheduleFallbackCheck() {
            if (!pendingPickerCheck) {
              pendingPickerCheck = true;
              setTimeout(function () {
                pendingPickerCheck = false;
                updateSelectionState();
              }, 180);
            }
          }

          chooseButton.addEventListener('click', function () {
            waitingForPicker = true;
            if (config.preparingLabel) {
              status.textContent = config.preparingLabel;
            }
            askConfirmation(
              config.pickerConfirmText || 'Open your phone gallery to choose files?',
              config.pickerConfirmCta || 'Open Gallery'
            ).then(function (shouldContinue) {
              if (!shouldContinue) {
                waitingForPicker = false;
                status.textContent = config.emptyLabel;
                return;
              }

              try {
                if (typeof fileInput.showPicker === 'function') {
                  fileInput.showPicker();
                } else {
                  fileInput.click();
                }
              } catch (_e) {
                fileInput.click();
              }
              scheduleFallbackCheck();
            });
          });

          fileInput.addEventListener('input', updateSelectionState);
          fileInput.addEventListener('change', updateSelectionState);
          window.addEventListener('focus', scheduleFallbackCheck);
          document.addEventListener('visibilitychange', function () {
            if (document.visibilityState === 'visible') {
              scheduleFallbackCheck();
            }
          });
          updateSelectionState();
        }

        bindFilePicker({
          inputId: 'photos',
          chooseButtonId: 'choose-photos-btn',
          submitButtonId: 'upload-photos-submit-btn',
          statusId: 'photo-selection-status',
          emptyLabel: 'No photos selected yet.',
          pickerConfirmText: 'Open your gallery to choose photos?',
          pickerConfirmCta: 'Continue Upload',
          itemLabel: 'photo'
        });

        bindFilePicker({
          inputId: 'videos',
          chooseButtonId: 'choose-videos-btn',
          submitButtonId: 'upload-videos-submit-btn',
          statusId: 'video-selection-status',
          emptyLabel: 'No videos selected yet.',
          preparingLabel: 'Preparing selected videos... this can take a moment on iPhone/Android.',
          pickerConfirmText: 'Open your gallery to choose videos? Large videos can take extra time to prepare.',
          pickerConfirmCta: 'Continue Upload',
          itemLabel: 'video'
        });

        const photoForm = document.getElementById('photo-upload-form');
        const photoInput = document.getElementById('photos');
        const photoChooseBtn = document.getElementById('choose-photos-btn');
        const photoSubmitBtn = document.getElementById('upload-photos-submit-btn');
        const photoNameInput = document.getElementById('name-photos');
        const photoProgress = document.getElementById('photo-upload-progress');
        const photoProgressBar = document.getElementById('photo-upload-progress-bar');
        const photoStatus = document.getElementById('photo-upload-status');
        const cancelPhotoUploadBtn = document.getElementById('cancel-photo-upload-btn');
        const photoNameValidation = document.getElementById('photo-name-validation');
        const photoFilesValidation = document.getElementById('photo-files-validation');

        if (
          photoForm &&
          photoInput &&
          photoChooseBtn &&
          photoSubmitBtn &&
          photoNameInput &&
          photoProgress &&
          photoProgressBar &&
          photoStatus &&
          cancelPhotoUploadBtn &&
          photoNameValidation &&
          photoFilesValidation
        ) {
          let activePhotoUploadXhr = null;
          let allowPhotoPageLeave = false;

          function setPhotoUploadBusyState(isBusy) {
            photoUploadBusy = isBusy;
            syncUploadBusyUi();
            if (!isBusy) {
              allowPhotoPageLeave = false;
            }
          }

          function setPhotoUploadingUiState(isUploading, statusText) {
            if (statusText) {
              photoStatus.hidden = false;
              photoStatus.textContent = statusText;
            } else if (!isUploading) {
              photoStatus.hidden = true;
            }

            photoSubmitBtn.disabled = isUploading || !photoInput.files || photoInput.files.length === 0;
            photoChooseBtn.disabled = isUploading;
            photoNameInput.readOnly = isUploading;
            cancelPhotoUploadBtn.hidden = !isUploading;

            if (!isUploading) {
              activePhotoUploadXhr = null;
              setPhotoUploadBusyState(false);
              if (!photoInput.files || photoInput.files.length === 0) {
                photoProgress.hidden = true;
              }
            }
          }

          cancelPhotoUploadBtn.addEventListener('click', function () {
            if (activePhotoUploadXhr) {
              activePhotoUploadXhr.abort();
            } else {
              setPhotoUploadingUiState(false, 'Upload cancelled.');
            }
          });

          photoForm.addEventListener('submit', function (event) {
            event.preventDefault();

            const nameValue = photoNameInput.value.trim();
            photoNameValidation.hidden = nameValue.length > 0;
            if (!photoInput.files || photoInput.files.length === 0) {
              photoFilesValidation.hidden = false;
              setPhotoUploadingUiState(false, 'Choose at least one photo first.');
              return;
            }
            photoFilesValidation.hidden = true;
            if (!nameValue) {
              setPhotoUploadingUiState(false, 'Please enter your name first.');
              return;
            }

            const totalPhotoBytes = Array.from(photoInput.files || []).reduce(function (sum, file) {
              return sum + (file.size || 0);
            }, 0);

            Promise.resolve(
              totalPhotoBytes >= 120 * 1024 * 1024
                ? askConfirmation(
                    `You selected ${formatBytes(totalPhotoBytes)} of photos. This may take several minutes. Keep this page open while it uploads.`,
                    'Continue Upload'
                  )
                : true
            ).then(function (shouldContinue) {
              if (!shouldContinue) {
                setPhotoUploadingUiState(false, 'Upload cancelled before start.');
                return;
              }

              const formData = new FormData(photoForm);
              photoProgress.hidden = false;
              photoProgressBar.style.width = '0%';
              setPhotoUploadingUiState(true, 'Uploading photos...');
              setPhotoUploadBusyState(true);

              const xhr = new XMLHttpRequest();
              activePhotoUploadXhr = xhr;
              xhr.open('POST', '/upload?ajax=1');
              xhr.timeout = 1000 * 60 * 10;

              xhr.upload.onprogress = function (e) {
                if (!e.lengthComputable) {
                  return;
                }
                const pct = Math.max(0, Math.min(100, Math.round((e.loaded / e.total) * 100)));
                photoProgressBar.style.width = `${pct}%`;
                if (pct >= 100) {
                  photoStatus.textContent = 'Upload sent. Finalising on server, please wait...';
                } else {
                  photoStatus.textContent = `Uploading photos... ${pct}%`;
                }
              };

              xhr.onload = function () {
                let payload = null;
                try {
                  payload = JSON.parse(xhr.responseText || '{}');
                } catch (_e) {
                  payload = null;
                }

                if (payload && payload.redirectUrl) {
                  setPhotoUploadBusyState(false);
                  allowPhotoPageLeave = true;
                  window.location.href = payload.redirectUrl;
                  return;
                }

                setPhotoUploadingUiState(false, 'Upload finished. Refreshing...');
                allowPhotoPageLeave = true;
                window.location.reload();
              };

              xhr.onerror = function () {
                setPhotoUploadingUiState(false, 'Upload failed. Please try again.');
              };

              xhr.onabort = function () {
                setPhotoUploadingUiState(false, 'Upload cancelled.');
              };

              xhr.ontimeout = function () {
                setPhotoUploadingUiState(false, 'Upload timed out. Please try again.');
              };

              xhr.send(formData);
            });
          });

          photoNameInput.addEventListener('input', function () {
            photoNameValidation.hidden = photoNameInput.value.trim().length > 0;
          });
          photoInput.addEventListener('change', function () {
            photoFilesValidation.hidden = !!(photoInput.files && photoInput.files.length > 0);
          });

          window.addEventListener('beforeunload', function (event) {
            if (!photoUploadBusy || allowPhotoPageLeave) {
              return;
            }
            event.preventDefault();
            event.returnValue = 'Photo upload is still in progress. Leaving now will cancel the upload.';
          });
        }

        const videoForm = document.getElementById('video-upload-form');
        const videoInput = document.getElementById('videos');
        const videoChooseBtn = document.getElementById('choose-videos-btn');
        const videoSubmitBtn = document.getElementById('upload-videos-submit-btn');
        const videoNameInput = document.getElementById('name-videos');
        const videoProgress = document.getElementById('video-upload-progress');
        const videoProgressBar = document.getElementById('video-upload-progress-bar');
        const videoStatus = document.getElementById('video-upload-status');
        const cancelVideoUploadBtn = document.getElementById('cancel-video-upload-btn');
        const videoSizeWarning = document.getElementById('video-size-warning');
        const videoNameValidation = document.getElementById('video-name-validation');
        const videoFilesValidation = document.getElementById('video-files-validation');

        if (
          videoForm &&
          videoInput &&
          videoChooseBtn &&
          videoSubmitBtn &&
          videoNameInput &&
          videoProgress &&
          videoProgressBar &&
          videoStatus &&
          cancelVideoUploadBtn &&
          videoSizeWarning &&
          videoNameValidation &&
          videoFilesValidation
        ) {
          let activeVideoUploadXhr = null;
          let allowPageLeave = false;

          function setVideoUploadBusyState(isBusy) {
            videoUploadBusy = isBusy;
            syncUploadBusyUi();
            if (!isBusy) {
              allowPageLeave = false;
            }
          }

          function formatBytes(bytes) {
            const gb = 1024 * 1024 * 1024;
            const mb = 1024 * 1024;
            if (bytes >= gb) {
              return `${(bytes / gb).toFixed(2)} GB`;
            }
            return `${(bytes / mb).toFixed(1)} MB`;
          }

          function updateVideoSizeWarning() {
            const files = Array.from(videoInput.files || []);
            if (files.length === 0) {
              videoSizeWarning.hidden = true;
              videoSizeWarning.textContent = '';
              return;
            }

            const totalBytes = files.reduce(function (sum, file) {
              return sum + (file.size || 0);
            }, 0);

            const totalMb = totalBytes / (1024 * 1024);
            if (totalMb >= 350) {
              videoSizeWarning.hidden = false;
              videoSizeWarning.textContent = `You selected ${formatBytes(totalBytes)} of videos. Upload may take several minutes, especially on mobile data.`;
              return;
            }

            videoSizeWarning.hidden = true;
            videoSizeWarning.textContent = '';
          }

          function setUploadingUiState(isUploading, statusText) {
            if (statusText) {
              videoStatus.hidden = false;
              videoStatus.textContent = statusText;
            } else if (!isUploading) {
              videoStatus.hidden = true;
            }

            videoSubmitBtn.disabled = isUploading || !videoInput.files || videoInput.files.length === 0;
            videoChooseBtn.disabled = isUploading;
            videoNameInput.readOnly = isUploading;
            cancelVideoUploadBtn.hidden = !isUploading;

            if (!isUploading) {
              activeVideoUploadXhr = null;
              setVideoUploadBusyState(false);
              if (!videoInput.files || videoInput.files.length === 0) {
                videoProgress.hidden = true;
              }
              updateVideoSizeWarning();
            }
          }

          cancelVideoUploadBtn.addEventListener('click', function () {
            if (activeVideoUploadXhr) {
              activeVideoUploadXhr.abort();
            } else {
              setUploadingUiState(false, 'Upload cancelled.');
            }
          });

          videoForm.addEventListener('submit', function (event) {
            event.preventDefault();

            const nameValue = videoNameInput.value.trim();
            videoNameValidation.hidden = nameValue.length > 0;
            if (!videoInput.files || videoInput.files.length === 0) {
              videoFilesValidation.hidden = false;
              setUploadingUiState(false, 'Choose at least one video first.');
              return;
            }
            videoFilesValidation.hidden = true;
            if (!nameValue) {
              setUploadingUiState(false, 'Please enter your name first.');
              return;
            }

            const totalVideoBytes = Array.from(videoInput.files || []).reduce(function (sum, file) {
              return sum + (file.size || 0);
            }, 0);

            Promise.resolve(
              totalVideoBytes >= 350 * 1024 * 1024
                ? askConfirmation(
                    `You selected ${formatBytes(totalVideoBytes)} of videos. This may take several minutes. Keep this page open while it uploads.`,
                    'Continue Upload'
                  )
                : true
            ).then(function (shouldContinue) {
              if (!shouldContinue) {
                setUploadingUiState(false, 'Upload cancelled before start.');
                return;
              }

              const formData = new FormData(videoForm);
              videoProgress.hidden = false;
              videoProgressBar.style.width = '0%';
              videoSizeWarning.hidden = true;
              setUploadingUiState(true, 'Uploading videos...');
              setVideoUploadBusyState(true);

              const xhr = new XMLHttpRequest();
              activeVideoUploadXhr = xhr;
              xhr.open('POST', '/upload/videos?ajax=1');
              xhr.timeout = 1000 * 60 * 20;

              xhr.upload.onprogress = function (e) {
                if (!e.lengthComputable) {
                  return;
                }
                const pct = Math.max(0, Math.min(100, Math.round((e.loaded / e.total) * 100)));
                videoProgressBar.style.width = `${pct}%`;
                if (pct >= 100) {
                  videoStatus.textContent = 'Upload sent. Finalising on server, please wait...';
                } else {
                  videoStatus.textContent = `Uploading videos... ${pct}%`;
                }
              };

              xhr.onload = function () {
                let payload = null;
                try {
                  payload = JSON.parse(xhr.responseText || '{}');
                } catch (_e) {
                  payload = null;
                }

                if (payload && payload.redirectUrl) {
                  setVideoUploadBusyState(false);
                  allowPageLeave = true;
                  window.location.href = payload.redirectUrl;
                  return;
                }

                setUploadingUiState(false, 'Upload finished. Refreshing...');
                allowPageLeave = true;
                window.location.reload();
              };

              xhr.onerror = function () {
                setUploadingUiState(false, 'Upload failed. Please try again.');
              };

              xhr.onabort = function () {
                setUploadingUiState(false, 'Upload cancelled.');
              };

              xhr.ontimeout = function () {
                setUploadingUiState(false, 'Upload timed out. Please try fewer or smaller videos.');
              };

              xhr.send(formData);
            });
          });

          videoNameInput.addEventListener('input', function () {
            videoNameValidation.hidden = videoNameInput.value.trim().length > 0;
          });
          videoInput.addEventListener('change', function () {
            videoFilesValidation.hidden = !!(videoInput.files && videoInput.files.length > 0);
          });

          videoInput.addEventListener('change', updateVideoSizeWarning);
          updateVideoSizeWarning();

          window.addEventListener('beforeunload', function (event) {
            if (!videoUploadBusy || allowPageLeave) {
              return;
            }
            event.preventDefault();
            event.returnValue = 'Video upload is still in progress. Leaving now will cancel the upload.';
          });
        }

        let touchStartY = null;
        window.addEventListener(
          'touchstart',
          function (event) {
            if (!document.body.classList.contains('upload-busy')) {
              touchStartY = null;
              return;
            }
            if (event.touches && event.touches.length === 1) {
              touchStartY = event.touches[0].clientY;
            }
          },
          { passive: true }
        );

        window.addEventListener(
          'touchmove',
          function (event) {
            if (!document.body.classList.contains('upload-busy')) {
              return;
            }
            if (window.scrollY > 0 || touchStartY === null || !event.touches || event.touches.length !== 1) {
              return;
            }
            const currentY = event.touches[0].clientY;
            const pullingDown = currentY - touchStartY > 8;
            if (pullingDown) {
              event.preventDefault();
            }
          },
          { passive: false }
        );

        setActiveTab(initialTab);
      })();
    </script>
  </body>
</html>
